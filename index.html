<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.84.0">
  <title>B Able</title>

  <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">

  <!-- Bootstrap core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
  <style>
    .large-block {
      background-color: #fdfdfd;
      margin: 10px 0;
      box-shadow: 0 4px 8px 0 rgb(0 0 0 / 11%), 0 6px 20px 0 rgb(0 0 0 / -3%);
      border-radius: 5px;
      height: 320px;
    }

    .small-block {
      background-color: #fdfdfd;
      height: 150px;
      box-shadow: 0 4px 8px 0 rgb(0 0 0 / 11%), 0 6px 20px 0 rgb(0 0 0 / -3%);
      border-radius: 5px;
      padding: 40px;
    }

    .bi {
      height: 60px;
      width: 60px;
    }

    .bi::before {
      vertical-align: 0;
    }

    .bi-bookmark-star::before {
      color: #563bff;
    }

    .bi-people-fill::before {
      color: #01c4f8;
    }

    .bi-book::before {
      color: #fd7670;
    }

    .bi-book-half::before {
      color: #63967c;
    }

    .main-title {
      font-weight: bold;
      font-size: 25px;
      color: #303856;
      text-align: center;
      padding: 10px;
    }

    .main-text {
      font-weight: bold;
      font-size: 20px;
      color: #303856;
    }

    .sub-text {
      color: #bdbfc6;
    }

    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>


  <!-- Custom styles for this template -->
  <link href="dashboard.css" rel="stylesheet">
</head>

<body>

  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="/">B Able Analytics</a>
    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse"
      data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-nav">
      <div class="nav-item text-nowrap">
      </div>
    </div>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">
                <span data-feather="home"></span>
                Dashboard
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">Dashboard</h1>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-sm-4 large-block">
              <div class="main-title">
                Total Number of Reads
                <div class="row">
                  <div id="totNumRead" class="col main-text" style="font-size: 150px;">
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="row" style="padding: 10px;">
                <div class="col small-block">
                  <div class="row">
                    <div class="col-2" style="justify-content: center; align-items: center; display: flex;">
                      <i class="bi bi-bookmark-star"
                        style="font-size: 30px; background: #efecff; border-radius: 30px; padding: 13px;"></i>
                    </div>
                    <div class="col-9">
                      <div class="row g-0">
                        <div class="col main-text" id="allTime">
                        </div>
                      </div>
                      <div class="row g-0">
                        <div class="col sub-text">
                          All-Time Favorite Book
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" style="padding: 10px;">
                <div class="col small-block">
                  <div class="row">
                    <div class="col-2" style="justify-content: center; align-items: center; display: flex;">
                      <i class="bi bi-people-fill"
                        style="font-size: 30px; background: #e5f9fd; border-radius: 30px; padding: 13px;"></i>
                    </div>
                    <div class="col-9">
                      <div class="row g-0">
                        <div class="col main-text" id="numOfUsers">
                        </div>
                      </div>
                      <div class="row g-0">
                        <div class="col sub-text">
                          Number of Users
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="row" style="padding: 10px;">
                <div class="container">
                  <div class="row">
                    <div class="col small-block">
                      <div class="row">
                        <div class="col-2" style="justify-content: center; align-items: center; display: flex;">
                          <i class="bi bi-book"
                            style="font-size: 30px; background: #f4e7df; border-radius: 30px; padding: 13px;"></i>
                        </div>
                        <div class="col-9">
                          <div class="row g-0">
                            <div class="col main-text" id="totNumBooks">
                            </div>
                          </div>
                          <div class="row g-0">
                            <div class="col sub-text">
                              Total Number of Books
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" style="padding: 10px;">
                <div class="col small-block">
                  <div class="row">
                    <div class="col-2" style="justify-content: center; align-items: center; display: flex;">
                      <i class="bi bi-book-half"
                        style="font-size: 30px; background: #dcf7e9; border-radius: 30px; padding: 13px;"></i>
                    </div>
                    <div class="col-9">
                      <div class="row g-0">
                        <div class="col main-text" id="totNumReadBooks">
                        </div>
                      </div>
                      <div class="row g-0">
                        <div class="col sub-text">
                          Total Number of Read Books
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>

        <h2>Library</h2>
        <div class="table-responsive" style="margin-bottom: 100px;">
          <table class="table table-striped table-sm" id="library">
            <thead>
              <tr>
                <th scope="col">Book Title</th>
                <th scope="col">Genre</th>
                <th scope="col"># of Read</th>
                <th scope="col">Upload Date</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>

        <!--different table: HTML-->
        <h2>Reviews</h2>
        <div class="table-responsive" style="margin-bottom: 100px;">
          <table class="table table-striped table-sm" id="reviews">
            <thead>
              <tr>
                <th scope="col">Book Title</th>
                <th scope="col">Date Added</th>
                <th scope="col">Email</th>
                <th scope="col">Question 1</th>
                <th scope="col">Question 1 Analysis</th>
                <th scope="col">Question 2</th>
                <th scope="col">Question 3</th>
                <th scope="col">Question 4</th>
                <th scope="col">Question 5</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>

      </main>
    </div>
  </div>


  <!--writing java script: <script...-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"
    integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"
    integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha"
    crossorigin="anonymous"></script>
  <script src="dashboard.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
  
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, query, where, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDBTnF_FgjV2XOAsZEDmkqDIjSURseYglw",
      authDomain: "b-able-f29d8.firebaseapp.com",
      projectId: "b-able-f29d8",
      storageBucket: "b-able-f29d8.appspot.com",
      messagingSenderId: "1007604371141",
      appId: "1:1007604371141:web:86bc03357ffdd62662eaac"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore();

    const bookCollection = collection(db, "books");
    const querySnapshot = await getDocs(bookCollection);
    var totNumRead = 0;
    var allTimeBook = "";
    var tempRead = -1;
    var totNumBooks = 0;
    var totNumReadBooks = 0;
    var bookData = [];
    querySnapshot.forEach((doc) => {
      var data = doc.data();
      var tempDate = new Date(data.upload_date.seconds * 1000)
      var tempDict = {
        "name": data["name-en"],
        "genre": data["genre-en"],
        "read": data.read,
        "upload_date": tempDate.getFullYear() + "/" + (tempDate.getMonth() + 1) + "/" + tempDate.getDate()
      }

      bookData.push(tempDict);
      

      totNumBooks = totNumBooks + 1;
      totNumRead = totNumRead + parseInt(data.read);
      if(data.read > tempRead)
      {
        allTimeBook = data['name-en'];
        tempRead = data.read;
      }

      if(data.read > 0)
      {
        totNumReadBooks = totNumReadBooks + 1;
      }
    });

    for(var i = 0; i < bookData.length; i++)
    {
      $('#library tbody').append("<tr><td>" + bookData[i]['name'] + "</td><td>" + bookData[i]['genre'] + "</td><td>" + bookData[i]['read'] + "</td><td>" + bookData[i]['upload_date'] + "</td></tr>");
    }

    const reviewCollection = collection(db, "review");
    const reviewSnapshot = await getDocs(reviewCollection);
    var reviewData = [];
    reviewSnapshot.forEach((doc)=>{
      var data = doc.data();
      var tempDate = new Date(data['dateAdded'].seconds * 1000); //convert date into seconds and then multiply by 1000 to get miliseconds
      var reviewDict = {
        'title':data['bookTitle'],
        'dateAdded': tempDate.getFullYear() + "/" + (tempDate.getMonth() + 1) + "/" + tempDate.getDate(),
        'email' : data['email'],
        'q1': data['q1'],
        'q1_result': data['q1_result'] ? data['q1_result']:"",
        'q2': data['q2'],
        'q3': data['q3'],
        'q4': data['q4'],
        'q5': data['q5']
      }


      reviewData.push(reviewDict);
    });

    for(var i = 0; i < reviewData.length; i++)
    {
      $('#reviews tbody').append("<tr><td>" + reviewData[i]['title'] + "</td><td>" + reviewData[i]['dateAdded'] + "</td><td>" + reviewData[i]['email'] + "</td><td>" + reviewData[i]['q1'] + "</td> <td>" + reviewData[i]['q1_result'] + "</td><td>" + reviewData[i]['q2'] + "</td><td>" + reviewData[i]['q3'] + "</td><td>" + reviewData[i]['q4'] + "</td><td>" + reviewData[i]['q5'] + "</td></tr>");
    }


    $("#totNumRead").html(totNumRead);
    $('#allTime').html(allTimeBook);
    $('#totNumBooks').html(totNumBooks);
    $('#totNumReadBooks').html(totNumReadBooks);

    const userCollection = collection(db, "users");
    const userSnapshot = await getDocs(userCollection);
    var numOfUsers = 0;
    var chartData = {
      0: 0,
      1: 0,
      2: 0,
      3: 0,
      4: 0,
      5: 0,
      6: 0,
      7: 0,
      8: 0,
      9: 0,
      10: 0,
    };

    userSnapshot.forEach(async(doc) => {
      numOfUsers = numOfUsers + 1;
      var data2 = doc.id;
      var userBookCollection = collection(db, "users", data2, "books");
      var userBookSnapshot = await getDocs(userBookCollection);
      chartData[userBookSnapshot.size] = chartData[userBookSnapshot.size] + 1;
      
    });



    



    // Graphs
    var ctx = document.getElementById('myChart')
    setTimeout(function(){ 
      $("#numOfUsers").html(numOfUsers);

      $('#library').DataTable();
      var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [
          0,
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          10
        ],
        datasets: [{
          data: Object.values(chartData),
          lineTension: 0,
          backgroundColor: '#563bff',
          borderColor: '#563bff',
          pointBackgroundColor: '#563bff',
          borderWidth: 1,
          borderRadius: 15,
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: false
            },
            scaleLabel: {
              display: true,
              labelString: "Num of Users"
            }
          }],
          xAxes: [{
            scaleLabel: {
              display: true,
              labelString: "Num of Books Read"
            }
          }]
        },
        legend: {
          display: false
        },
        title: {
          display: true,
          text: "Number of users per books read"
        }
      }
    })
  }, 500);
  </script>
</body>

</html>